<div class="container">
  <h2><%= @project.name %></h2>
  <br>
  <div class="row">
    <div class="col-lg-7">
      <table summary="fields">
        <tr>
          <th>Total Duration:</th>
          <% if @project.total_duration %>
           <td><%= time_ago_in_words(@project.total_duration.seconds.ago, include_seconds: true)if @project.total_duration %></td>
          <% else %>
            <td>No tasks</td>
          <% end %>
        </tr>
        <% if @project.organization %>
          <tr>
            <th>Organization: </th>
            <td><%= @project.organization.name %></td>
          </tr>
        <% end %>
      </table>
    </div>
    <% unless request.format.to_sym == :pdf %>
      <div class="col-lg-5">
        <div class="btn-group">
          <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
            Options <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu">
            <% if current_user.can_create? @project.project_memberships.build %>
              <li><%= link_to "Invite Members", new_project_membership_path(project_id: @project) %></li>
              <li><%= link_to "Manage Members", edit_project_membership_path(project_id: @project), method: :get %></li>
            <% end %>
            <% if current_user.can_append? @project.project_memberships.build  %>
              <li><%= link_to "Add to Organization", append_project_path, method: :get %></li>
            <% elsif already_in_project? @project %>
              <li><%= link_to "Leave Project", leave_project_membership_path(project_id: @project), data: { confirm: 'Are you sure?'} %></li>
            <% else %>
              <li><%= link_to "Join Project", join_project_path(project_id: @project), method: :post %></li>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>
  </div>
  <br>
  <% unless request.format.to_sym == :pdf %>
    <h3> Users </h3>
    <table summary="User list" class="table table-hover">
      <tr class="header">
        <th>Name</th>
        <th>Email</th>
        <th>Access Level</th>
      </tr>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td><%= "#{user.first_name} #{user.last_name}" %></td>
            <td><%= user.email %></td>
            <td><%= user.project_memberships.find_by(project_id: @project).role %></td>
        <% if current_user.can_delete? @project.project_memberships.build  %>
              <% unless user.can_delete?(@project) || current_user.id == user.id %>
                <td> <%= link_to "Remove", project_membership_path(user_id: user.id, project_id: @project), 
                  method: :delete, data: { confirm: 'Are you sure?' }  %></td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
  <br>
  <%unless @time_entries.empty? %>
    <h3> Time Entries </h3>
    <table summary="TimeEntry list" class="table table-hover">
      <tr class="header">
        <th>Time Entry Name</th>
        <th>User</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Total Time</th>
      </tr>
      <tbody>
        <% @time_entries.each do |time_entry| %>
          <tr>
            <td><%= time_entry.name %></td>
            <td><%= "#{time_entry.user.first_name} #{time_entry.user.last_name}" %></td>
            <td><%= time_entry.start_time.strftime("%H:%M:%S %d/%m/%y") %></td>
            <td><%= time_entry.end_time.try(:strftime, "%H:%M:%S %d/%m/%y") %></td>
            <td><%= time_ago_in_words(time_entry.total_time.seconds.ago, include_seconds: true) unless time_entry.total_time.blank? %></td>
          </tr>
        <% end %>
      <tbody>
    </table>
    <div class="row">
      <div class="col-lg-7">
        <%= page_entries_info @time_entries, entry_name: 'Time Entries' %>
      </div>
      <div class="col-lg-5">
        <%= paginate @time_entries %>
      </div>
    </div>
  <% end %>
  </br>
    <% unless request.format.to_sym == :pdf %>
    <div class="pull-right">
    <%= link_to '.PDF', { format: :pdf },  class: "btn btn-danger" %>
    </div>
  <% end %>
</div>
